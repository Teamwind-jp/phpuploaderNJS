# phpuploaderNJS
  
本プロジェクトは、Node.jsによるサーバーサイドの保守ツールです。  
指定フォルダをzip(password付)し指定サイズで分割後、他サーバーへアップロード(php)しバックアップしています。  
  
処理内容は、  
1.指定フォルダをzip。  
2.負荷のかからないサイズの複数ファイルにカット。  
3.順次phpサーバーへアップロードしています。  
4.phpサーバー側で結合し保管。phpも添付しています。(receive.php)  
以上です。  
  
※※補足※※  
Windowsサーバー用に.Net版で公開中の 下記プロジェクトと同様の処理をNodejs(JavaScript)版で作るとどうなるのかという目的で作成しました。よろしければこちらのリポリトジもご覧ください。  
phpuploader  basic版  
phpuploaderCS c#版  
  
# Requirement
Windows11上で書いています。  
nvmにてnodejsをインストール。現時点では下記バージョンです。  
Visual Studio Codeを使用しています。バージョン: 1.103.2  
Node.js: 22.17.0  
  
本プロジェクトを実行するためのphpサーバーを別途用意してください。  
  
# Usage
1.本プロジェクトのソース以外に使用しているライブラリ（node_modules）は下記です。  
　archiver (zip用)  
　archiver-zip-encryptable (zip暗号化サポート)  
　iconv-lite 　(utf8 -> sjis変換 zipのパスワード用)  
　axios form-data (upload用)  
　以上をターミナルにてインストールしています。  
  
2.index.jsのenv変数を実行環境に合わせて設定してください。  
　分割サイズは、php.iniの「post_max_size = 」側と合わせて調整してください。  
    
3.ターミナルにて[npm start]で実行します。  
  
4.添付しているreceive.phpは、公開中の.net版と共通です。フォルダの指定などwindowsサーバー前提にしていますので適宜変更してください。  
  
5.日次バッチ処理する場合は、'node-cron'でindex.js内のasync内をループさせるかwindowsタスクスケジューラーに発火用のコマンドを登録してください。  

6.もし公開サーバーで検証する場合は、phpのファイル名を複雑怪奇にしたり認証処理も追加するなどセキュリティを強化した方がよいと思います。
  
# How It Works
  
1.uploadに至る各機能別処理は、別々のソースにしています。index.jsでコールする構成です。各処理は非同期ですのでawaitで待って指定フォルダ分をループしています。  
  
2.phpは、受信したファイルのmd5値をprmと比較、最終ファイルなら結合をしています。  
  
# Tecnical Details
  
1.zip。  
2.ファイルio。  
3.md5取得。  
4.upload。  
5.非同期処理。  
  
# Note
  
本プロジェクトは、実際に運用している.net版を元にしています。Node.jsで作るとどうなるか？という目的で作成しましたが同じ結果になりました。phpは、.net版と共通です。  
実際に運用する場合は、もう少しセキュリティとエラー対策を強化する必要があります。サーバー負荷軽減の調整も必要です。  
コードはすべてwindows前提です。他OSはパス等適宜変更してください。  
バグがあるかもしれません。自己責任でご利用ください。また適宜コード変更してください。  
ご要望等がございましたらメール下さい。  
  
# License
rootのjsのみ　MIT license。著作権は、Teamwindです。  
その他ライブラリは、ライブラリ作者に帰属します。  
